

# 2 简单的文本编辑

## vi命令

## 移动光标

### 单一的移动
* h
* j
* k
* l

### 数值参数

### 在一行中移动

### 按照文本块来移动 ws


## 简单的编辑

### 更改文本

* cw 从光标到单词结尾
* c2b 从光标往前两个单词
* c$ 从光标到本行结尾
* c0 从光标到此行的开头

#### 单词
#### 整行cc
* C = c$ 可以更改光标到本行末尾的文本
#### 字符
* r 替换字符,会将指定的字符位置替换成相同的字符，会自动回到命令模式
* R 进入覆盖模式进行替换
#### 替换文本s
* s 替换字符，从当前光标开始
* S 整行删除，进入插入模式

### 更改大小写
* ~ 小写替换成大写/大写替换成小写

### 删除文本d
#### 单词
* dw 删除单词或者光标到单词末尾
* de 删除到单词末尾不包括空白
* dE 删除到单词末尾包括标点
* db 向前删除
 
#### 整行
* dd 删除整行
* D 删除光标开始到本行结束

#### 字符
* x 删除光标所在位置的字符

#### 删除文件时发生的问题
* u 撤销上一个dd
* U
* p 恢复最近的错误
* (n)p 从第(n)缓冲区恢复

### 移动文本
* p 将文本放在光标后
* P 将文本放在光标前

#### 对调两个字符

### 复制文本
* yy=Y 拖拽一整行

### 重复或者撤销上一个命令
#### 重复
* . 重复上一个命令

#### 撤销
* u 撤销上一个命令并恢复删除的行
* U 撤销对同一行的所有编辑动作
* Ctrl+R 重做 redo

### 更多插入文本的方法
* A 在一行的结尾处附加文本
* I 在一行的开头处插入文本
* o 在光标所在位置的下一行打开新行
* O 在光标所在位置的上一行打开新行
* s 删除光标所在位置后再替换文本
* S 删除一整行后再替换文本
* R 用新字符覆盖现有字符
以上命令都会进入插入模式

### 插入命令的数值参数
格式：（数值）命令（重复字符）

### 用J合并两行
* j 合并两行

# 3 快速移动位置
## 根据屏幕来移动

### 滚动一整屏
* ^F 往前滚动一整屏
* ^B 往后滚动一整屏
* ^D 往前（下）滚动半屏
* ^U 往后（上）滚动半屏

### 用z调整屏幕位置
* z <code>ENTER</code> 将光标移到屏幕顶端并滚动屏幕
* z. 将光标移到屏幕中间并滚动屏幕
* z- 将光标移到屏幕底端并滚动屏幕

### 重画屏幕
* <code>CTRL+L</code>

### 在屏幕中移动
* H 移到屏幕顶端的行
* M 移到屏幕中央的行
* L 移到屏幕底端的行
* nH 移到屏幕顶端往下的n行
* nL 移到屏幕底端网上的n行

### 根据行移动
* <code>ENTER</code> 移到下一行的第一个字符
* \+ 移到下一行的第一个字符
* \- 移到上一行的第一个字符

#### 在当前行移动
* ^ 移到当前行的第一个非空格处
* n| 移到当前行的第n列

## 根据文本块来移动
* e 移到单词的结尾
* E 移到单词的结尾（忽略标点符号）
* ( 移到当前句子的开头
* ) 移到当前句子的结尾
* { 移到当前段的开头
* } 移到当前段的结尾
* [[ 移到当前这一节的开头
* ]] 移到下一节的开头

## 根据搜索模式的结果来移动
* / 搜索模式字符串
* ? 往回搜索模式字符串

### 重复搜索
* n 往同一个方向重复搜索
* N 往相反的方向重复搜索
* /<code>ENTER</code> 往前重复搜索
* ?<code>ENTER</code> 往后重复搜索

#### 通过搜索修改文本
* d?move 向前删除直到出现move的地方

### 在当前行中搜索
* fx 搜索（将光标移到）本行中下一个出现x的地方，x代表任何字符
* Fx 搜索（将光标移到）本行中上一个出现x的地方
* tx 搜索（将光标移到）本行中下一个出现x的地方的前一个字符
* Tx 搜索（将光标移到）本行中下一个出现x的地方的后一个字符
* ; 重复上一个搜索命令，方向相同
* , 重复上一个搜索命令，方向相反

## 根据行号来移动
* :set nu 显示行号
* :(行号) 移动到行号行

### G（转至）命令
* nG 移动到农行
* `` 回到上一次G命令的行(如果搜索命令，则回到上一次搜索命令的地方)
* '' 回到上一次命令的行的开头

# 4越过基础的藩篱
## 更多命令的组合
命令组合的一般形式<br/>
(number)(command)(text object)<br/>

## 打开vi的选项
### 前进到特定的位置
* vi +n file 在第n行打开file
* vi + file 在最后一行打开file
* vi +/parttern file 在第一个出现pattern的地方打开file
* +/"you make" 或者 +/you\ make 如果模式中包含空格 
  
### 只读模式
* vi -R/view file 只读模式

### 恢复缓冲区
* ex -r/vi -r 得到系统保存下来的所有文件列表
* vi -r file 恢复原来的文件
* :pre 强制系统没有死机也保存缓冲区

## 善加利用缓冲区
### 恢复删除
* "np 恢复第n个缓冲区到
* "1pu.u.u 每次u撤销当前恢复，.恢复下个缓冲区

### 将文本拖曳到命名缓冲区中
* "dyy 将当前行拖曳到缓冲区d中
* "a7yy 将后续7行拖曳到缓冲区a中
* "dP 将缓冲区d的内容放置在光标前
* "ap 将缓冲区a的内容放置在光标后
* "a5dd 将删除的5行保存到缓冲区a中
* "zd) 删除从光标开始到句子结尾处的内容，并且将内容保存到缓冲区z中
* 2) 往前移两个句子
* "Zy) 将下一个句子添加到z中，大写字母添加到后面，小写会覆盖掉原有内容


## 对一处做标记
* mx 将当前位置标记成x
* 'x 将光标移到标记x所在行的第一个字符
* `x 将光标移到以x标记的字符
* `` 移动位置之后，回到上一个标记或上下文的确切位置
* '' 回到上一个标记或者上下文所在行的开头

# 5ex编辑器概述
## ex命令
行地址+命令<br/>

* 1p 显示一行，p可以省略
* 1,3 显示1到3行
* s/screen/line 替换命令，没有行号只对当前行起作用
* vi 进入vi模式

## 用ex编辑
* d 删除行
* m 移动行
* co/t 复制行

### 行地址
指定行地址的方法：
* 指定明确行号
* 用符号来指定相对于当前位置的行号
* 标识某些行的搜索模式作为地址

### 定义行范围
* 3,18d 删除第3行到第18行
* 160,224m23 将160到224行移到第23行之后
* 23,29co100 将第23到第29行复制到100行之后
* :set number/:set nu 显示行号
* :set nonumber/:set nonu 取消显示行号
* :1,10# 暂时显示某些行的编号
* := 列出文件的总行数
* :.=列出当前所在行的行号
* :/pattern/= 列出pattern第一次出现的行号

### 行寻址符号
* . 当前行
* $ 文件的最后一行
* % 表示文件中的每一行
* :,$d 删除当前行到最后一行
* 20,.m$ 移动20到当前行到文件末尾
* %d 删除文件中的所有行
* %t$ 复制所有行到文件末尾
* .,.+20d 删除当前行到之后20行之间的文本
* 226,$m.-2 将226到结尾移到当前行前面的两行之前
* .,+20# 显示当前行及向下20行之间的行号（使用+/-号可以省略点号）
* -,+t0 复制三行并放到文件开头

### 搜索模式

* :/pattern/d 删除下一个包含pattern的行
* :/pattern/+d 删除下一个包含pattern的行的下一行
* :/pattern1/,/pattern2/d 从pattern1的行删除到pattern2的行
* :.,/pattern/m23 将当前行到pattern的行移动到23行后

### 重新定义当前行的位置
* :100,+5 p 错误，+5相对于当前光标的位置，第一个不能超过第二个的位置
* :100;+5 p 当使用分号时，第一个位置会被当成光标当前位置

### 全局搜索
* :g/pattern 寻找文件中最后一次出现pattern的地方
* :g/pattern/p 寻找并显示文件中所有包含pattern的行
* :g!/pattern/nu 寻找并显示文件中所有不包含pattern的行，显示所有行号
* 60,124g/pattern/p 寻找并显示60,124之间所有包含pattern的行

### 合并ex的命令
* | 合并多个命令
* :1,3 d | s/thier/their/ 删除1,3行，接着在当前行做替换

### 保存与离开文件
* :w 将缓冲区内容写入文件中，但不离开
* :q 离开编辑器
* :wq 写入文件同时离开编辑器，无条件写入
* :x 写入文件同时离开编辑器，只有被修改才写入

### 更改缓冲区名称
* :w practice.new 

### 保存一部分的文件
* :230,$w newfile 将230行到文件结尾保存为newfile文件
* :.,600w newfile 将光标所在行到600行保存为newfile文件

### 附加内容到已保存文件
* :340,$w >>newfile

## 将一个文件复制到另一个文件
* :read/:r filename 将filename的内容插入到光标所在的下一行

## 编辑多个文件
### 用vi同时打开多个文件
* :n vi打开了多个文件时，:n调用下一个文件

### 使用参数列表
* :args 显示vi打开的文件列表，方括号括起当前编辑中文件的名称
* :rewind/:rew 复位成命令行的上一个文件
* :last 移动成命令行上的最后一个 

### 调用新文件
* :e filenaname 切换到另一个文件
* % 代表当前文件
* \# 代表候补文件
* :e! 放弃编辑结果

### 在vi中切换文件
* <code>CTRL + ^</code> 切换文件

### 在文件之间做编辑
* :160,224ya a 将文本拖曳到缓冲区a中
* :pu a 将缓冲区a内容放置到当前行所在行的下一行

# 6 全局替换
* :s/old/new/ 将当前行第一个old替换为new
* :s/old/new/g 将当前行的所有old替换为new
* :1,$s/old/new/g 将整个文件old替换为new
* :%s/old/new/g 将整个文件old替换为new

## 确认替换
* :1,30s/his/the/gc 每一次替换之前做确认
* /which 搜索which
* cwthat<code>ESC</code> 改成that
* n 重复搜索
* n 重复搜索省略一次改变
* . 重复改变

### 与上下文相关的替换
* :g/pattern/s/old/new/g 将具有pattern的行中的old替换成new
* :g/string/s//new/g 将所有包含string行中的string替换为new

### 模式匹配的规则

#### 用在搜索模式中的元字符
* . 匹配出任何单一字符（换行符除外），请记住空格也是字符
* \* 陪出此符号前的单一字符，该字符可出现零到多次
*  ^ 用在正则表达式必须位于一行的开头
*  $ 用在正则表达式的结尾
*  \ 将后面的特殊字符当成一般字符
*  [] 匹配出方括号里的任何一个字符
*  \(\) 会将\(\)间的模式保存保存到特殊的空间
*  \< \> 会匹配出以某些字符开头或结尾的单词
*  ~ 匹配出任何上一次搜索时所使用的正则表达式

### POSIX方括号表达式
![](./pic/posix方括号表达式.jpg)
|类型|比较出的字符|

### 用在替换字符串中的元字符
在替换字符串中仍然具有特殊意义的元字符
* \n 利用\(和\)的第n个模式的文字做代换
* \ 将后面一个字符当成一般字符
* & 替换成搜索模式匹配出的完整文本
* ~ 找到的字符串会被最后一个替换命令中的替换字符串替换
* \u或\l 式替换字符串的下一个字符编程大写或者小写
* \U或\L与\e或\E 直到替换字符串结束或者到\e或\E 的所有字符替换为大写或小写

### 更多更换技巧
* :s=:s//~/ 重复上一次替换
* :%&g 在所有地方重复上一个低缓
* :&=:s<code>ENTER</code> 可以节省一次回车
* :~类似:&但是搜索模式为上一个出现的正则表达式不一定是上一个替换命令中的正则表达式
* :%s;/user1/tim;/home/tim;g 除了/字符，任何非字母、非数字、非空格的字符均可以做分隔字符
* :set edcompatible 会记住上一次替换的标志（g表示全局，c标识确认），并继续用在下一次替换中

## 模式匹配的范例
* :%s/\<child\>/children/g

### 搜索一般的但此类
* :g/mg\([ira]\)box/s//mg\1square/g
* :g/mg[ira]box/s/box/square/g

### 用模式移动文本块
* :g /SYNTAX/.,/DESCRIPTION/-1 move /PARAMETERS/-1 将SYNTAX的行到DESCRIPTION 上一行移动到PRAMETER上一行

### 更多范例
* :%s/RETURN/\\fI&\\fP/g 在单词RETURN 前后加上troff的斜体代码
* :%s:/home/tim:/home/linda:g
* :%s:ENTER:\<i\>&\</i\>:g 将ENTER前后加上HTML的斜体代码
* :1,10s/\./;/g 将1,10行中的句号改为分号
* :%s/[Hh]elp/HELP/g 将所有出现的help改为HELP
* :%s/  */ /g 将一个或多个空格替换成一个空格
* :%s/:  */:  /g 将冒号后面的一个或多个空格替换成两个空格
* :%s/\([:.]\)  */\1  /g在括号中的两个字符都可以用于匹配
* 

## 模式匹配的最后叮咛
### 删除位置的文本块
* :g/moving$/s/.*of times;/The greatest of times;/

### 在文本数据库中交换条目
* :%s/: \([^,]*\),\([^;]*\);/: \2 \1;/


### 用:g重复命令
这块没太看懂
![](./pic/用g重复命令.jpg)

### 收集行
* :g /^Chapter/ .+2w >> begin 将每章的第一行内容送到begin文件中

# 7高级编辑方法
## 自定义vi
### :set命令
* :set option 打开某个切换选项
* :set nooption 关闭某个切换选项
* :set ic 指定模式搜索忽略大小写
* :set noic 指定vi回到分辨大小写的状态
* :set window=20 指定行数
* :set all 显示选项的完整列表
* :set option? 按照名称寻找任何个别选项的当前值

### .exrc文件
### 其他环境
### 一些有用的选项

## 执行Unix命令
* :!command ！告诉ex创建一个shell，并执行shell命令
* :sh 使用ex创建一个shell
* <code>CTRL-D</code> 结束shell并回到vi
* :r !date 读入Unix命令到文件中

## 通过命令过滤文本
### 用ex过滤文本
* :96,99!sort 将96和99行间的文本送给sort过滤，并替换原有内容
### 用vi过滤文本
没看懂这块

## 保存命令
### 单词缩写
* :ab abbr phrase abbr 是指定给phrase的缩写
* :ubab abbr 取消一个缩写
* 缩写所用的字符不能同时出现在代表的词组的结尾，否则会出现递归

### 使用map命令
* :map x sequence 定义字符x映射到一个编辑命令sequence
* :unmap x 取消定义给x的编辑命令sequence
* :map 列出所有被映射的字符

不会在命令模式中使用的键
* 字母
  * g,K,q,V,v
* 控制键
  * ^A、^K、^O、^W与^X
* 符号
  * _、*、\、=


* :map v dwe1p 使用v键完成颠倒两个单词的顺序的功能

## 保护按键免被ex解释

## 复杂的映射范例

# 8vi同类品的功能总览

# 9 vim概述

